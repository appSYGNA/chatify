<!DOCTYPE html>
<html lang="en">
<head>
<title>Chatify!</title>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
<script src="/nowjs/now.js"></script>

<script>
$(document).ready(function(){

  now.receiveMessage = function(name, date, message){
    $("#messages").append("<br>" + date + " " + name + ": " + message);
    $('#messages').scrollTop(200);
  }
  
  now.receiveHistory = function(history){
  	$.each(history, function(key,value){
		$("#messages").append("<br>" + value["date"] + " " + value["name"] + ": " + value["message"]);
  	});
  	$('#messages').scrollTop(200);
  }
  
  now.updateUserList = function(name) {
	 // $.each(names, function(key, value) { 
		  $("#users").append("<span id='"+name+"'><br>" + name + "</span>");
	//	});
  }
  
  now.removeUser = function(name){
	  $("#"+name).remove();
  }

  $("#send-button").click(function(){
    sendMessage();
  });
  
	$('#text-input').bind('keypress', function(e) {
		if(e.keyCode==13){
			sendMessage();
				// Enter pressed... do anything here...
		}
	});

	get = getUrlVars();
	if(get["name"]!=null) now.name = get["name"];
	else now.name = prompt("What's your name?", "");

	sendMessage = function(){
		now.distributeMessage($("#text-input").val());
		$("#text-input").val("");
	}
	
// Read a page's GET URL variables and return them as an associative array.
function getUrlVars()
{
    var vars = [], hash;
    var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
    for(var i = 0; i < hashes.length; i++)
    {
        hash = hashes[i].split('=');
        vars.push(hash[0]);
        vars[hash[0]] = hash[1];
    }
    return vars;
}
});
</script>
</head>

<body>
	<table border=1px style="width:500px; max-height:50px;">
		<tr>
			<td style="width:80%; "><div id="messages" style="max-height:200px; min-height:200px; max-width:400px; overflow:auto; overflow-x:hidden;"></div></td>
			<td style="width:20%;"><div id="users" style="max-height:200px; min-height:200px; max-width:100px; overflow:auto; overflow-x:hidden;"></div></td>
		</tr>
	</table>
  <input type="text" id="text-input" style="width:300px;">
  <input type="button" value="Send" id="send-button">
</body>
</html>
